<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenStreetMap with Multiple Markers</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        #map {
            height: 100vh;
            width: 100vw;
        }
        h1 {
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    // Initialize the map
    const map = L.map('map').setView([22.362891, 114.050456], 14); // Default center

    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
    }).addTo(map);

    // Function to get URL parameters
    function getParameterByName(name, url = window.location.href) {
        const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
        const results = regex.exec(url);
        if (!results) return null;
        return results[2] ? decodeURIComponent(results[2].replace(/\+/g, ' ')) : '';
    }

    // Get and decode the data parameter
    const dataParam = getParameterByName('data');
    if (dataParam) {
        try {
            const jData = dataParam.split('@').map(e => parseFloat(e)); // Decode and parse JSON

            // Create an array of marker coordinates
            const jsonData = [];
            for (let i = 0; i < jData.length; i += 2) {
                if (i + 1 < jData.length) {
                    jsonData.push({ lat: jData[i], lon: jData[i + 1] });
                }
            }

            // Add markers to the map
            jsonData.forEach(({ lat, lon }, i) => {
                const marker = (i === 0) 
                    ? L.marker([lat, lon], {
						icon: L.icon({
							iconUrl: 'https://raw.githubusercontent.com/Mcc-Mak/bb95.group-game.github.io/refs/heads/main/UserPosition.png', // Replace with a valid red marker image URL
							iconSize: [25, 41], // Size of the icon
							iconAnchor: [12, 41], // Anchor point of the icon
							// popupAnchor: [1, -34], // Popup anchor point
						})
					}) // Use red icon for the first marker
                    : L.marker([lat, lon], {
						icon: L.icon({
							iconUrl: 'https://raw.githubusercontent.com/Mcc-Mak/bb95.group-game.github.io/refs/heads/main/TreasurePosition.png', // Replace with a valid red marker image URL
							iconSize: [25, 41], // Size of the icon
							iconAnchor: [12, 41], // Anchor point of the icon
							// popupAnchor: [1, -34], // Popup anchor point
						})
					}); // Use default icon for other markers

                // marker.addTo(map)
                //     .bindPopup(`Lat: ${lat}, Lon: ${lon}`);
            });

            // Adjust view to fit all markers
            const bounds = jsonData.map(({ lat, lon }) => [lat, lon]);
            map.fitBounds(bounds);
        } catch (error) {
            console.error('Error parsing data parameter:', error);
            alert('Invalid data format. Please provide valid Base64 encoded coordinates.');
        }
    }
</script>

</body>
</html>
