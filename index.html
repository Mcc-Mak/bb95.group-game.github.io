<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiple Markers on OpenStreetMap</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body { margin: 0; }
        #map { height: 600px; width: 100%; }
    </style>
</head>
<body>

<h1>OpenStreetMap with Multiple Markers</h1>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    // Initialize the map
    const map = L.map('map').setView([22.362891, 114.050456], 14); // Default center

    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
    }).addTo(map);

    // Function to get URL parameters
    function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[[]]/g, '\\$&');
        const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
              results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    // Get and decode the data parameter
    const dataParam = getParameterByName('data');
    if (dataParam) {
		window.e = dataParam;
        const jsonData = JSON.parse(atob(dataParam)); // Decode and parse JSON

        // Add markers to the map
        jsonData.forEach(coords => {
            const lat = coords.lat;
            const lon = coords.lon;
			console.log(lat,lon)
            L.marker([lat, lon]).addTo(map)
                .bindPopup(`Lat: ${lat}, Lon: ${lon}`);
        });

        // Adjust view to fit all markers
        const bounds = jsonData.map(coords => [coords.lat, coords.lon]);
        map.fitBounds(bounds);
    }
</script>

</body>
</html>
